{{template "front_header.tmpl" .}}



<div class="layui-container">
    <div class="header">
        <h2 style="padding: 20px;text-align: center;">NDMå­˜å‚¨ç®¡ç†</h2>
    </div>
</div>

<div class="layui-container" style="width:70%;min-width: 500px;">
    <div id="nav">
        <span class="layui-breadcrumb">
            <a href="/">ğŸ ä¸»é¡µ</a>
            <a href="">å›½é™…æ–°é—»</a>
            <a href="">äºšå¤ªåœ°åŒº</a>
            <a><cite>æ­£æ–‡</cite></a>
        </span>
    </div>
    <div id="list" class="bgw divtable"></div>
</div>


<div class="layui-container">
    <div class="layui-row">
        <div class="layui-col-md12">
            <table id="list2" lay-filter="ndm-list"></table>
        </div>
    </div>
</div>

<script>
layui.use(['layer','form','element','jquery','table','laydate','util'],function(){
///
var $ = layui.$;
var layer = layui.layer;
var form = layui.form;
var table = layui.table;
var laydate = layui.laydate;
var util = layui.util;


// layui.table.set({
//      request: {
//      headers: {
//        'X-Table-Request': 'true11'
//      },
//      pageName: 'page',
//      limitName: 'size'
//      },
//  response: {
//      statusName: 'code',
//      statusCode: 200,
//      msgName: 'message',
//      countName: 'total',
//      dataName: 'data'
//  }
// });

var args = {
    page: 1,
    password : "",
    path : location.pathname,
    per_page: 0,
    refresh: false,
}


function renderList(){

    var content = '<div class="divtable">\
            <table class="table table-hover" width="100%" cellspacing="0" cellpadding="0" border="0" style="border: 0 none;">\
            <thead>\
                <tr>\
                    <td style="width:50%;">åç§°</td>\
                    <td style="width:20%;text-align:right;">å¤§å°</td>\
                    <td style="width:30%;text-align:right;">æ—¶é—´</td>\
                </tr>\
            </thead>\
            <tbody></tbody>\
            </table>\
        </div>';
    $('#list').html(content);

    var loadT = layer.msg('æ­£åœ¨è·å–...', { icon: 16, time: 0, shade: 0.3 });
    $.post('{{.api_path}}/fs/list', args, function(data){
        layer.close(loadT);

        var body = '';
        if (data.code==200){
            var list = data['data']['content'];

            for (var i = 0; i < list.length; i++) {

                if (location.pathname == "/"){
                    body += '<tr style="border: 0 none;" file="/'+list[i]['name']+'" >';
                } else {
                    body += '<tr style="border: 0 none;" file="'+location.pathname+"/"+list[i]['name']+'" >';
                }
                
                if (list[i]['is_dir']){
                    body += '<td>'+'<span class="ico ico-folder"></span>'+'<a class="text">'+list[i]['name']+'</a></td>';
                } else {
                    body += '<td>'+'<span class="ico ico-file"></span>'+'<a class="text">'+list[i]['name']+'</a></td>';
                }

                if (list[i]['is_dir'] || list[i]['size']==0){
                    body += '<td style="text-align:right;"><a class="text">-</a></td>';
                } else {
                    body += '<td style="text-align:right;"><a class="text">'+toSize(list[i]['size'])+'</a></td>';
                }
                
                body += '<td style="text-align:right;"><a class="text">'+isoTimeFormat(list[i]['modified'])+'</a></td>';
                body += '</tr>';
            }

        } else {
            body += '<tr><td colspan="3" style="text-align: center;">'+data['msg']+'</td></tr>';
        }

        // console.log(body);
        $('#list tbody').html(body);
        $('#list tr').click(function(){
            var fname = $(this).attr("file");
            if (fname){
                location.href = fname;
            }
        });
    });
}

renderList();



// table.render({
//  headers: {
//       'Authorization': localStorage.getItem('token')
//     },
//     elem: '#list2',
//     url: '{{.api_path}}/fs/list',
//     request: {
//         pageName: 'page',
//         limitName: 'size'
//     },
//     defaultToolbar: [],
//     title: 'æ•°æ®è¡¨',
//     method: 'post',
//     cols: [[
//         {field:'mount_path', title:'åç§°'},
//         {field:'order', title:'åºå·'},
//         {field:'remark', title:'å¤‡æ³¨', width:180},
//     ]],
//     page: true,
//     where:[],
// });

// // refresh
// $("#refresh").click(function(){
//     table.reload("list");
// });


// æ·»åŠ 

///
});
</script>



{{template "front_footer.tmpl" .}}